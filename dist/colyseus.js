!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Colyseus=e():t.Colyseus=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=13)}([function(t,e,n){"use strict";function r(t,e,n,r){var i,o=!1;switch(e){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":i="number",isNaN(t)&&console.log('trying to encode "NaN" in '+n.constructor.name+"#"+r);break;case"string":i="string",o=!0;break;case"boolean":return}if(typeof t!==i&&(!o||o&&null!==t)){var s="'"+JSON.stringify(t)+"'"+(t&&t.constructor&&" ("+t.constructor.name+")");throw new d("a '"+i+"' was expected, but "+s+" was provided in "+n.constructor.name+"#"+r)}}function i(t,e,n,r){if(!(t instanceof e))throw new d("a '"+e.name+"' was expected, but '"+t.constructor.name+"' was provided in "+n.constructor.name+"#"+r)}function o(t,e,n,i,o){var s=c[t];return void 0===n?e.push(u.NIL):r(n,t,i,o),!!s&&(s(e,n),!0)}function s(t,e,n){var r=h[t];return r?r(e,n):null}var a=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),c=n(35),h=n(36),f=n(1),l=n(2),p=n(11),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(Error),v=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Object.defineProperties(this,{$changes:{value:new p.ChangeTree,enumerable:!1,writable:!0}});var n=this._descriptors;n&&Object.defineProperties(this,n)}return t.onError=function(t){console.error(t)},Object.defineProperty(t.prototype,"_schema",{get:function(){return this.constructor._schema},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_descriptors",{get:function(){return this.constructor._descriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_indexes",{get:function(){return this.constructor._indexes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_filters",{get:function(){return this.constructor._filters},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_deprecated",{get:function(){return this.constructor._deprecated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$changed",{get:function(){return this.$changes.changed},enumerable:!0,configurable:!0}),t.prototype.decode=function(e,n){void 0===n&&(n={offset:0});var r=[],i=this._schema,o=this._indexes,a={};Object.keys(o).forEach(function(t){var e=o[t];a[e]=t});var c=e.length;e[n.offset]===u.TYPE_ID&&(n.offset+=2);for(var p=this;n.offset<c;){if("break"===function(){var o=e[n.offset++];if(o===u.END_OF_STRUCTURE)return"break";var c=a[o],d=i[c],v=void 0,y=void 0,g=!1;if(!c)return"continue";if(d._schema)h.nilCheck(e,n)?(n.offset++,v=null):(v=p["_"+c]||p.createTypeInstance(e,n,d),v.decode(e,n)),g=!0;else if(Array.isArray(d)){d=d[0],y=[];var _=p["_"+c]||new f.ArraySchema;v=_.clone(!0);var m=h.number(e,n),b=Math.min(h.number(e,n),m);g=b>0;var w=!1;v.length>m&&Array.prototype.splice.call(v,m).forEach(function(e,n){if(e&&e.onRemove)try{e.onRemove()}catch(e){t.onError(e)}if(_.onRemove)try{_.onRemove(e,m+n)}catch(e){t.onError(e)}});for(var C=0;C<b;C++){var O=h.number(e,n),A=void 0;h.indexChangeCheck(e,n)&&(h.uint8(e,n),A=h.number(e,n),w=!0);var S=!w&&void 0===v[O]||w&&void 0===A;if(d.prototype instanceof t){var k=void 0;if(k=S?p.createTypeInstance(e,n,d):void 0!==A?_[A]:_[O],k||(k=p.createTypeInstance(e,n,d),S=!0),h.nilCheck(e,n)){if(n.offset++,_.onRemove)try{_.onRemove(k,O)}catch(e){t.onError(e)}continue}k.decode(e,n),v[O]=k}else v[O]=s(d,e,n);if(S){if(_.onAdd)try{_.onAdd(v[O],O)}catch(e){t.onError(e)}}else if(_.onChange)try{_.onChange(v[O],O)}catch(e){t.onError(e)}y.push(v[O])}}else if(d.map){d=d.map;var E=p["_"+c]||new l.MapSchema;v=E.clone(!0);var I=h.number(e,n);g=I>0;for(var w=!1,T=Object.keys(E),C=0;C<I&&(void 0!==e[n.offset]&&e[n.offset]!==u.END_OF_STRUCTURE);C++){var x=void 0;h.indexChangeCheck(e,n)&&(h.uint8(e,n),x=T[h.number(e,n)],w=!0);var P=h.numberCheck(e,n),M="string"!=typeof d,j=P?T[h.number(e,n)]:h.string(e,n),k=void 0,S=!w&&void 0===E[j]||w&&void 0===x&&P;if(k=S&&M?p.createTypeInstance(e,n,d):void 0!==x?E[x]:E[j],h.nilCheck(e,n)){if(n.offset++,k&&k.onRemove)try{k.onRemove()}catch(e){t.onError(e)}if(E.onRemove)try{E.onRemove(k,j)}catch(e){t.onError(e)}delete v[j]}else if(M?(k.decode(e,n),v[j]=k):v[j]=s(d,e,n),S){if(E.onAdd)try{E.onAdd(v[j],j)}catch(e){t.onError(e)}}else if(E.onChange)try{E.onChange(v[j],j)}catch(e){t.onError(e)}}}else v=s(d,e,n),g=!0;g&&p.onChange&&r.push({field:c,value:y||v,previousValue:p["_"+c]}),p["_"+c]=v}())break}if(this.onChange&&r.length>0)try{this.onChange(r)}catch(e){t.onError(e)}return this},t.prototype.encode=function(t,e,n){var r=this;void 0===t&&(t=this),void 0===e&&(e=!1);var s=[];if(!this.$changes.changed&&!e)return this._encodeEndOfStructure(this,t,s),s;for(var a=this._schema,h=this._indexes,p=this._filters,d=(this._deprecated,e||n?this.$changes.allChanges:this.$changes.changes),v=this,y=0,g=d.length;y<g;y++)!function(y,g){var _=d[y],m=a[_],b=p&&p[_],w=v["_"+_],C=h[_];if(void 0===w)return"continue";var O=[];if(m._schema){if(n&&b&&!b.call(v,n,w,t))return"continue";c.number(O,C),w?(i(w,m,v,_),v.tryEncodeTypeId(O,m,w.constructor),O.push.apply(O,w.encode(t,e,n))):c.uint8(O,u.NIL)}else if(Array.isArray(m)){c.number(O,C),c.number(O,w.length);var A=(e||n?w.$changes.allChanges:w.$changes.changes).filter(function(t){return void 0!==r["_"+_][t]}).sort(function(t,e){return t-e}),S=A.length;c.number(O,S);var k="string"!=typeof m[0];i(v["_"+_],f.ArraySchema,v,_);for(var E=0;E<S;E++){var I=A[E],T=v["_"+_][I];if(!n||!b||b.call(v,n,T,t))if(k){if(c.number(O,I),!e){var x=w.$changes.getIndexChange(T);void 0!==x&&(c.uint8(O,u.INDEX_CHANGE),c.number(O,x))}i(T,m[0],v,_),v.tryEncodeTypeId(O,m[0],T.constructor),O.push.apply(O,T.encode(t,e,n))}else if(c.number(O,I),!o(m[0],O,T,v,_)){console.log("cannot encode",a[_]);continue}}e||w.$changes.discard()}else if(m.map){c.number(O,C);var P=e||n?w.$changes.allChanges:w.$changes.changes;c.number(O,P.length);var M=w.$changes.allChanges,k="string"!=typeof m.map,S=P.length;i(v["_"+_],l.MapSchema,v,_);for(var j=0;j<S;j++){var R="number"==typeof P[j]&&M[P[j]]||P[j],T=v["_"+_][R],$=void 0;if(!n||!b||b.call(v,n,T,t)){if(e){if(void 0===T)continue}else{var x=w.$changes.getIndexChange(T);T&&void 0!==x&&(c.uint8(O,u.INDEX_CHANGE),c.number(O,v["_"+_]._indexes.get(x))),$=w.$changes.isDeleted(R)&&T?void 0:v["_"+_]._indexes.get(R)}void 0!==$?c.number(O,$):c.string(O,R),T&&k?(i(T,m.map,v,_),v.tryEncodeTypeId(O,m.map,T.constructor),O.push.apply(O,T.encode(t,e,n))):void 0!==T?o(m.map,O,T,v,_):c.uint8(O,u.NIL)}}e||(w.$changes.discard(),n||v["_"+_]._updateIndexes(w.$changes.allChanges))}else{if(n&&b&&!b.call(v,n,w,t))return"continue";if(c.number(O,C),!o(m,O,w,v,_))return console.log("cannot encode",a[_]),"continue"}s=s.concat(O)}(y);return this._encodeEndOfStructure(this,t,s),e||n||this.$changes.discard(),s},t.prototype.encodeFiltered=function(t){return this.encode(this,!1,t)},t.prototype.encodeAll=function(){return this.encode(this,!0)},t.prototype.encodeAllFiltered=function(t){return this.encode(this,!0,t)},t.prototype.clone=function(){var t=new this.constructor,e=this._schema;for(var n in e)"object"==typeof this[n]&&"function"==typeof this[n].clone?t[n]=this[n].clone():t[n]=this[n];return t},t.prototype.triggerAll=function(){if(this.onChange){var e=[],n=this._schema;for(var r in n)void 0!==this[r]&&e.push({field:r,value:this[r],previousValue:void 0});try{this.onChange(e)}catch(e){t.onError(e)}}},t.prototype.toJSON=function(){var t=this._schema,e=this._deprecated,n={};for(var r in t)e[r]||null===this[r]||void 0===this[r]||(n[r]="function"==typeof this[r].toJSON?this[r].toJSON():this["_"+r]);return n},t.prototype._encodeEndOfStructure=function(t,e,n){t!==e&&n.push(u.END_OF_STRUCTURE)},t.prototype.tryEncodeTypeId=function(t,e,n){e._typeid!==n._typeid&&(c.uint8(t,u.TYPE_ID),c.uint8(t,n._typeid))},t.prototype.createTypeInstance=function(t,e,n){if(t[e.offset]===u.TYPE_ID){e.offset++;return new(this.constructor._context.get(h.uint8(t,e)))}return new n},t}();e.Schema=v},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=t.apply(this,n)||this;return Object.setPrototypeOf(i,Object.create(e.prototype)),Object.defineProperties(i,{$sorting:{value:void 0,enumerable:!1,writable:!0},$changes:{value:void 0,enumerable:!1,writable:!0},onAdd:{value:void 0,enumerable:!1,writable:!0},onRemove:{value:void 0,enumerable:!1,writable:!0},onChange:{value:void 0,enumerable:!1,writable:!0},triggerAll:{value:function(){if(i.onAdd)for(var t=0;t<i.length;t++)i.onAdd(i[t],t)}},toJSON:{value:function(){for(var t=[],e=0;e<i.length;e++){var n=i[e];t.push("function"==typeof n.toJSON?n.toJSON():n)}return t}},clone:{value:function(t){var n;return t?(n=new(e.bind.apply(e,[void 0].concat(i))),n.onAdd=i.onAdd,n.onRemove=i.onRemove,n.onChange=i.onChange):n=new(e.bind.apply(e,[void 0].concat(i.map(function(t){return"object"==typeof t?t.clone():t})))),n}}}),i}return r(e,t),e.prototype.sort=function(e){this.$sorting=!0,t.prototype.sort.call(this,e);for(var n=this.$changes.changes,r=0,i=n;r<i.length;r++){var o=i[r],s=this.$changes.getIndex(this[o]);void 0!==s&&this.$changes.mapIndexChange(this[o],s),this.$changes.mapIndex(this[o],o)}return this.$sorting=!1,this},e.prototype.filter=function(e,n){var r=t.prototype.filter.call(this,e);return r.$changes=this.$changes,r},e.prototype.splice=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Array.prototype.splice.apply(this,arguments),o=Array.prototype.filter.call(this,function(n,r){return r>=t+e-1});return i.map(function(t){t&&t.$changes&&(t.$changes.parent.deleteIndex(t),t.$changes.parent.deleteIndexChange(t),delete t.$changes.parent)}),o.forEach(function(t){t&&t.$changes&&t.$changes.parentField--}),i},e}(Array);e.ArraySchema=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(e){var n=this;void 0===e&&(e={});for(var r in e)this[r]=e[r];Object.defineProperties(this,{$changes:{value:void 0,enumerable:!1,writable:!0},onAdd:{value:void 0,enumerable:!1,writable:!0},onRemove:{value:void 0,enumerable:!1,writable:!0},onChange:{value:void 0,enumerable:!1,writable:!0},clone:{value:function(e){var r;if(e)r=Object.assign(new t,n),r.onAdd=n.onAdd,r.onRemove=n.onRemove,r.onChange=n.onChange;else{var i=new t;for(var o in n)"object"==typeof n[o]?i[o]=n[o].clone():i[o]=n[o]}return r}},triggerAll:{value:function(){if(n.onAdd)for(var t in n)n.onAdd(n[t],t)}},toJSON:{value:function(){var t={};for(var e in n)t[e]="function"==typeof n[e].toJSON?n[e].toJSON():n[e];return t}},_indexes:{value:new Map,enumerable:!1,writable:!0},_updateIndexes:{value:function(t){for(var e=0,r=new Map,i=0,o=t;i<o.length;i++){var s=o[i];r.set(s,e++)}n._indexes=r}}})}return t}();e.MapSchema=r},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(16)),o=r(n(17));e.decode=i.default,e.encode=o.default},function(t,e,n){"use strict";function r(t,e){e.headers=t.headers||{},e.statusMessage=t.statusText,e.statusCode=t.status,e.data=t.response}function i(t,e,n){return new Promise(function(i,o){n=n||{};var s,a,u,c,h=new XMLHttpRequest,f=n.headers||{};n.timeout&&(h.timeout=n.timeout),h.ontimeout=h.onerror=function(t){t.timeout="timeout"==t.type,o(t)},h.open(t,e),h.onload=function(){for(c=h.getAllResponseHeaders().trim().split(/[\r\n]+/),r(h,h);u=c.shift();)u=u.split(": "),h.headers[u.shift().toLowerCase()]=u.join(": ");if((u=h.headers["content-type"])&&~u.indexOf("application/json"))try{h.data=JSON.parse(h.data,n.reviver)}catch(t){return r(h,t),o(t)}(h.status>=400?o:i)(h)},(a=n.body)&&"object"==typeof a&&(f["content-type"]="application/json",a=JSON.stringify(a)),h.withCredentials=!!n.withCredentials;for(s in f)h.setRequestHeader(s,f[s]);h.send(a)})}Object.defineProperty(e,"__esModule",{value:!0}),e.send=i,n.d(e,"get",function(){return o}),n.d(e,"post",function(){return s}),n.d(e,"patch",function(){return a}),n.d(e,"del",function(){return u}),n.d(e,"put",function(){return c});var o=i.bind(i,"GET"),s=i.bind(i,"POST"),a=i.bind(i,"PATCH"),u=i.bind(i,"DELETE"),c=i.bind(i,"PUT")},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(3)),o=n(18),s=n(19),a=n(6),u=n(7),c=function(){function t(t,e){var n=this;this.onJoin=o.createSignal(),this.onStateChange=o.createSignal(),this.onMessage=o.createSignal(),this.onError=o.createSignal(),this.onLeave=o.createSignal(),this.id=null,this.name=t,e?(this.serializer=new(a.getSerializer("schema")),this.rootSchema=e,this.serializer.state=new e):this.serializer=new(a.getSerializer("fossil-delta")),this.onError(function(t){return console.error(t)}),this.onLeave(function(){return n.removeAllListeners()})}return t.prototype.connect=function(t){var e=this;this.connection=new s.Connection(t,!1),this.connection.reconnectEnabled=!1,this.connection.onmessage=this.onMessageCallback.bind(this),this.connection.onclose=function(t){e.onLeave.invoke(t.code)},this.connection.onerror=function(t){console.warn("Room, onError ("+t.code+"): "+t.reason),e.onError.invoke(t.reason)},this.connection.open()},t.prototype.leave=function(t){void 0===t&&(t=!0),this.connection?t?this.connection.send([u.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(4e3)},t.prototype.send=function(t){this.connection.send([u.Protocol.ROOM_DATA,t])},Object.defineProperty(t.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!0,configurable:!0}),t.prototype.listen=function(t,e,n){return"schema"===this.serializerId?void console.error("'"+this.serializerId+"' serializer doesn't support .listen() method."):(this.serializerId||console.warn("room.Listen() should be called after room.onJoin has been called (DEPRECATION WARNING)"),this.serializer.api.listen(t,e,n))},t.prototype.removeListener=function(t){return this.serializer.api.removeListener(t)},t.prototype.removeAllListeners=function(){this.serializer&&this.serializer.teardown(),this.onJoin.clear(),this.onStateChange.clear(),this.onMessage.clear(),this.onError.clear(),this.onLeave.clear()},t.prototype.onMessageCallback=function(t){if(this.previousCode)this.previousCode===u.Protocol.ROOM_STATE?this.setState(Array.from(new Uint8Array(t.data))):this.previousCode===u.Protocol.ROOM_STATE_PATCH?this.patch(Array.from(new Uint8Array(t.data))):this.previousCode===u.Protocol.ROOM_DATA&&this.onMessage.invoke(i.decode(t.data)),this.previousCode=void 0;else{var e=new DataView(t.data),n=e.getUint8(0);if(n===u.Protocol.JOIN_ROOM){var r=1;this.serializerId=u.utf8Read(e,r),r+=u.utf8Length(this.serializerId);var o=a.getSerializer(this.serializerId);if(!o)throw new Error("missing serializer: "+this.serializerId);if("fossil-delta"===this.serializerId||this.rootSchema||(this.serializer=new o),e.buffer.byteLength>r&&this.serializer.handshake){var s=Array.from(new Uint8Array(e.buffer.slice(r)));this.serializer.handshake(s)}this.onJoin.invoke()}else n===u.Protocol.JOIN_ERROR?this.onError.invoke(u.utf8Read(e,1)):n===u.Protocol.LEAVE_ROOM?this.leave():this.previousCode=n}},t.prototype.setState=function(t){this.serializer.setState(t),this.onStateChange.invoke(this.serializer.getState())},t.prototype.patch=function(t){this.serializer.patch(t),this.onStateChange.invoke(this.serializer.getState())},t}();e.Room=c},function(t,e,n){"use strict";function r(t,e){o[t]=e}function i(t){return o[t]}Object.defineProperty(e,"__esModule",{value:!0});var o={};e.registerSerializer=r,e.getSerializer=i},function(t,e,n){"use strict";function r(t,e){for(var n=t.getUint8(e++),r="",i=0,o=e,s=e+n;o<s;o++){var a=t.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));i=(7&a)<<18|(63&t.getUint8(++o))<<12|(63&t.getUint8(++o))<<6|(63&t.getUint8(++o))<<0,i>=65536?(i-=65536,r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&t.getUint8(++o))<<6|(63&t.getUint8(++o))<<0);else r+=String.fromCharCode((31&a)<<6|63&t.getUint8(++o));else r+=String.fromCharCode(a)}return r}function i(t){void 0===t&&(t="");for(var e=0,n=0,r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n+1}Object.defineProperty(e,"__esModule",{value:!0});!function(t){t[t.JOIN_ROOM=10]="JOIN_ROOM",t[t.JOIN_ERROR=11]="JOIN_ERROR",t[t.LEAVE_ROOM=12]="LEAVE_ROOM",t[t.ROOM_DATA=13]="ROOM_DATA",t[t.ROOM_STATE=14]="ROOM_STATE",t[t.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH"}(e.Protocol||(e.Protocol={})),e.utf8Read=r,e.utf8Length=i},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){function i(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),s=n(23),a="colyseus-auth-token";!function(t){t.ios="ios",t.android="android"}(e.Platform||(e.Platform={}));var u=function(){function t(t){var e=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=t.replace("ws","http"),s.getItem(a,function(t){return e.token=t})}return Object.defineProperty(t.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!0,configurable:!0}),t.prototype.login=function(t){return void 0===t&&(t={}),r(this,void 0,void 0,function(){var e,n,r,u,c;return i(this,function(i){switch(i.label){case 0:e=[];for(n in t)e.push(n+"="+t[n]);return this.token&&e.push("token="+this.token),[4,o.post(this.endpoint+"/auth?"+e.join("&"),{headers:{Accept:"application/json"}})];case 1:r=i.sent(),u=r.data,this.token=u.token,s.setItem(a,this.token);for(c in u)this.hasOwnProperty(c)&&(this[c]=u[c]);return this.registerPingService(),[2,this]}})})},t.prototype.save=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,o.put(this.endpoint+"/auth",{headers:{Accept:"application/json",Authorization:"Bearer "+this.token},body:{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}})];case 1:return t.sent(),[2,this]}})})},t.prototype.getFriends=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,o.get(this.endpoint+"/friends/all",{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,t.sent().data]}})})},t.prototype.getOnlineFriends=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,o.get(this.endpoint+"/friends/online",{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,t.sent().data]}})})},t.prototype.getFriendRequests=function(t){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,o.get(this.endpoint+"/friends/requests",{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,t.sent().data]}})})},t.prototype.sendFriendRequest=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,o.post(this.endpoint+"/friends/requests?userId="+t,{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,e.sent().data]}})})},t.prototype.acceptFriendRequest=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,o.put(this.endpoint+"/friends/requests?userId="+t,{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,e.sent().data]}})})},t.prototype.declineFriendRequest=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,o.del(this.endpoint+"/friends/requests?userId="+t,{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,e.sent().data]}})})},t.prototype.blockUser=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,o.post(this.endpoint+"/friends/block?userId="+t,{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,e.sent().data]}})})},t.prototype.unblockUser=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,o.put(this.endpoint+"/friends/block?userId="+t,{headers:{Accept:"application/json",Authorization:"Bearer "+this.token}})];case 1:return[2,e.sent().data]}})})},t.prototype.logout=function(){this.token=void 0,s.removeItem(a),this.unregisterPingService()},t.prototype.registerPingService=function(t){var e=this;void 0===t&&(t=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){o.get(e.endpoint+"/auth",{headers:{Accept:"application/json",Authorization:"Bearer "+e.token}})},t)},t.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},t}();e.Auth=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0);e.Schema=r.Schema;var i=n(2);e.MapSchema=i.MapSchema;var o=n(1);e.ArraySchema=o.ArraySchema;var s=n(37);e.Reflection=s.Reflection,e.ReflectionType=s.ReflectionType,e.ReflectionField=s.ReflectionField;var a=n(12);e.type=a.type,e.deprecated=a.deprecated,e.filter=a.filter,e.defineTypes=a.defineTypes,e.Context=a.Context},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.END_OF_STRUCTURE=193,e.NIL=192,e.INDEX_CHANGE=212,e.TYPE_ID=213},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=n(1),o=n(2),s=function(){function t(t,e,n){void 0===t&&(t=null),void 0===n&&(n=!1),this.changed=!1,this.changes=[],this.allChanges=[],this.deletedKeys={},this.linkedTrees=[],this.parent=e,this.parentField=t,this.trackAllChanges=n}return t.prototype.link=function(t){this.linkedTrees.push(t)},t.prototype.change=function(t,e){void 0===e&&(e=!1),this.changed=!0,-1===this.changes.indexOf(t)&&this.changes.push(t);var n=this.allChanges.indexOf(t);e||-1!==n?e&&n>=0&&this.allChanges.splice(n,1):this.allChanges.push(t),this.parent&&this.parent.change(this.parentField)},t.prototype.mapIndex=function(t,e){"object"==typeof t&&(this.indexMap||(this.indexMap=new Map,this.indexChange=new Map),this.indexMap.set(t,e))},t.prototype.getIndex=function(t){return this.indexMap&&this.indexMap.get(t)},t.prototype.deleteIndex=function(t){this.deletedKeys[this.indexMap.get(t)]=!0,this.indexMap.delete(t)},t.prototype.isDeleted=function(t){return void 0!==this.deletedKeys[t]},t.prototype.mapIndexChange=function(t,e){"object"==typeof t&&this.indexChange.set(t,e)},t.prototype.getIndexChange=function(t){return this.indexChange&&this.indexChange.get(t)},t.prototype.deleteIndexChange=function(t){this.indexChange.delete(t)},t.prototype.changeAll=function(t){if(t instanceof r.Schema){var e=t._schema;for(var n in e)(t[n]instanceof r.Schema||t[n]instanceof i.ArraySchema||t[n]instanceof o.MapSchema)&&!t[n].$changes.parent.parent&&(t[n].$changes.parent=this),this.change(n)}else for(var s=Object.keys(t),a=0,u=s;a<u.length;a++){var c=u[a];this.change(c)}},t.prototype.discard=function(){this.changed=!1,this.changes=[],this.deletedKeys={},this.indexChange&&this.indexChange.clear()},t}();e.ChangeTree=s},function(t,e,n){"use strict";function r(t,n){return void 0===n&&(n=e.globalContext),function(e,r){var i=e.constructor;if(i._context=n,n.has(i)||(n.add(i),i._schema=Object.assign({},i._schema||{}),i._indexes=Object.assign({},i._indexes||{}),i._descriptors=Object.assign({},i._descriptors||{}),i._deprecated=Object.assign({},i._deprecated||{})),i._indexes[r]=Object.keys(i._schema).length,i._schema[r]=t,!i._descriptors[r]){var o=Array.isArray(t),s=!o&&t.map,c="function"==typeof i._schema[r],h="_"+r;i._descriptors[h]={enumerable:!1,configurable:!1,writable:!0},i._descriptors[r]={get:function(){return this[h]},set:function(t){if((o||s)&&(t=new Proxy(t,{get:function(t,e){return t[e]},set:function(t,e,n){if("length"!==e&&0!==e.indexOf("$")){var r=o?Number(e):String(e);if(!t.$sorting){var i=t.$changes.getIndex(n);void 0!==i&&t.$changes.mapIndexChange(n,i),t.$changes.mapIndex(n,r)}n instanceof u.Schema?n.$changes.parent||(n.$changes=new a.ChangeTree(r,t.$changes),n.$changes.changeAll(n)):t[e]=n,t.$changes.change(r)}else t[e];return t[e]=n,!0},deleteProperty:function(t,e){var n=t[e];s&&void 0!==n&&(t.$changes.deleteIndex(n),t.$changes.deleteIndexChange(n),n.$changes&&delete n.$changes.parent),delete t[e];var r=o?Number(e):String(e);return t.$changes.change(r,!0),!0}})),t!==this[h])if(this[h]=t,o){this.$changes.change(r),t.$changes=new a.ChangeTree(r,this.$changes);for(var e=0;e<t.length;e++)t[e]instanceof u.Schema&&(t[e].$changes=new a.ChangeTree(e,t.$changes),t[e].$changes.changeAll(t[e])),t.$changes.mapIndex(t[e],e),t.$changes.change(e)}else if(s){t.$changes=new a.ChangeTree(r,this.$changes),this.$changes.change(r);for(var n in t)t[n]instanceof u.Schema&&(t[n].$changes=new a.ChangeTree(n,t.$changes),t[n].$changes.changeAll(t[n])),t.$changes.mapIndex(t[n],n),t.$changes.change(n)}else c?(this.$changes.change(r),t&&(t.$changes=new a.ChangeTree(r,this.$changes),t.$changes.changeAll(t))):this.$changes.change(r)},enumerable:!0,configurable:!0}}}}function i(t){return function(e,n){var r=e.constructor;r._filters||(r._filters={}),r._filters[n]=t}}function o(t,n){return void 0===t&&(t=!0),void 0===n&&(n=e.globalContext),function(e,n){var r=e.constructor;r._deprecated[n]=!0,t&&(r._descriptors[n]={get:function(){throw new Error(n+" is deprecated.")},set:function(t){},enumerable:!1,configurable:!0})}}function s(t,e){for(var n in e)r(e[n])(t.prototype,n);return t}Object.defineProperty(e,"__esModule",{value:!0});var a=n(11),u=n(0),c=function(){function t(){this.types={},this.schemas=new Map}return t.prototype.has=function(t){return this.schemas.has(t)},t.prototype.get=function(t){return this.types[t]},t.prototype.add=function(t){t._typeid=this.schemas.size,this.types[t._typeid]=t,this.schemas.set(t,t._typeid)},t}();e.Context=c,e.globalContext=new c,e.type=r,e.filter=i,e.deprecated=o,e.defineTypes=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(14);var r=n(15);e.Client=r.Client;var i=n(7);e.Protocol=i.Protocol;var o=n(5);e.Room=o.Room;var s=n(8);e.Auth=s.Auth,e.Platform=s.Platform;var a=n(29);e.FossilDeltaSerializer=a.FossilDeltaSerializer;var u=n(34);e.SchemaSerializer=u.SchemaSerializer;var c=n(6);e.registerSerializer=c.registerSerializer;var h=n(9);e.Schema=h.Schema,e.type=h.type,c.registerSerializer("fossil-delta",a.FossilDeltaSerializer),c.registerSerializer("schema",u.SchemaSerializer)},function(t,e){ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return null!==t&&"object"==typeof t&&t.buffer instanceof ArrayBuffer})},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(t,e,n,r){function i(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(4),u=n(5),c=n(8),h=n(24),f=s(n(25)),l=function(t){function e(n,r){var i=t.call(this,n)||this;return i.code=r,Object.setPrototypeOf(i,e.prototype),i}return r(e,t),e}(Error);e.MatchMakeError=l;var p=function(){function t(t){this.endpoint=t,this.auth=new c.Auth(this.endpoint),this.push=new h.Push(this.endpoint)}return t.prototype.joinOrCreate=function(t,e,n){return void 0===e&&(e={}),i(this,void 0,void 0,function(){var r=this;return o(this,function(s){switch(s.label){case 0:return[4,f.default(function(){return i(r,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",t,e,n)];case 1:return[2,r.sent()]}})})},{retries:3,minTimeout:0,maxTimeout:0})];case 1:return[2,s.sent()]}})})},t.prototype.create=function(t,e,n){return void 0===e&&(e={}),i(this,void 0,void 0,function(){var r=this;return o(this,function(s){switch(s.label){case 0:return[4,f.default(function(){return i(r,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("create",t,e,n)];case 1:return[2,r.sent()]}})})},{retries:3,minTimeout:0,maxTimeout:0})];case 1:return[2,s.sent()]}})})},t.prototype.join=function(t,e,n){return void 0===e&&(e={}),i(this,void 0,void 0,function(){var r=this;return o(this,function(s){switch(s.label){case 0:return[4,f.default(function(){return i(r,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("join",t,e,n)];case 1:return[2,r.sent()]}})})},{retries:3,minTimeout:0,maxTimeout:0})];case 1:return[2,s.sent()]}})})},t.prototype.joinById=function(t,e,n){return void 0===e&&(e={}),i(this,void 0,void 0,function(){var r=this;return o(this,function(s){switch(s.label){case 0:return[4,f.default(function(){return i(r,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinById",t,e,n)];case 1:return[2,r.sent()]}})})},{retries:3,minTimeout:0,maxTimeout:0})];case 1:return[2,s.sent()]}})})},t.prototype.reconnect=function(t,e,n){return i(this,void 0,void 0,function(){var r=this;return o(this,function(s){switch(s.label){case 0:return[4,f.default(function(){return i(r,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return[4,this.createMatchMakeRequest("joinById",t,{sessionId:e},n)];case 1:return[2,r.sent()]}})})},{retries:3,minTimeout:0,maxTimeout:0})];case 1:return[2,s.sent()]}})})},t.prototype.getAvailableRooms=function(t){return void 0===t&&(t=""),i(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:return e=this.endpoint.replace("ws","http")+"/matchmake/"+t,[4,a.get(e,{headers:{Accept:"application/json"}})];case 1:return[2,n.sent().data]}})})},t.prototype.createMatchMakeRequest=function(t,e,n,r){return void 0===n&&(n={}),i(this,void 0,void 0,function(){var i,s,u;return o(this,function(o){switch(o.label){case 0:return i=this.endpoint.replace("ws","http")+"/matchmake/"+t+"/"+e,this.auth.hasToken&&(n.token=this.auth.token),[4,a.post(i,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if(s=o.sent().data,s.error)throw new l(s.error,s.code);return u=this.createRoom(e,r),u.id=s.room.roomId,u.sessionId=s.sessionId,u.connect(this.buildEndpoint(s.room,{sessionId:u.sessionId})),[2,new Promise(function(t,e){var n=function(t){return e(t)};u.onError.once(n),u.onJoin.once(function(){u.onError.remove(n),t(u)})})]}})})},t.prototype.createRoom=function(t,e){return new u.Room(t,e)},t.prototype.buildEndpoint=function(t,e){void 0===e&&(e={});var n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(r+"="+e[r]);return this.endpoint+"/"+t.processId+"/"+t.roomId+"?"+n.join("&")},t}();e.Client=p},function(t,e,n){"use strict";function r(t){if(this._offset=0,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}function i(t,e,n){for(var r="",i=0,o=e,s=e+n;o<s;o++){var a=t.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));i=(7&a)<<18|(63&t.getUint8(++o))<<12|(63&t.getUint8(++o))<<6|(63&t.getUint8(++o))<<0,i>=65536?(i-=65536,r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&t.getUint8(++o))<<6|(63&t.getUint8(++o))<<0);else r+=String.fromCharCode((31&a)<<6|63&t.getUint8(++o));else r+=String.fromCharCode(a)}return r}function o(t){var e=new r(t),n=e._parse();if(e._offset!==t.byteLength)throw new Error(t.byteLength-e._offset+" trailing bytes");return n}r.prototype._array=function(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=this._parse();return e},r.prototype._map=function(t){for(var e="",n={},r=0;r<t;r++)e=this._parse(),n[e]=this._parse();return n},r.prototype._str=function(t){var e=i(this._view,this._offset,t);return this._offset+=t,e},r.prototype._bin=function(t){var e=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,e},r.prototype._parse=function(){var t,e=this._view.getUint8(this._offset++),n=0,r=0,i=0,o=0;if(e<192)return e<128?e:e<144?this._map(15&e):e<160?this._array(15&e):this._str(31&e);if(e>223)return-1*(255-e+1);switch(e){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:return n=this._view.getUint8(this._offset),r=this._view.getInt8(this._offset+1),this._offset+=2,[r,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),r=this._view.getInt8(this._offset+2),this._offset+=3,[r,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),r=this._view.getInt8(this._offset+4),this._offset+=5,[r,this._bin(n)];case 202:return t=this._view.getFloat32(this._offset),this._offset+=4,t;case 203:return t=this._view.getFloat64(this._offset),this._offset+=8,t;case 204:return t=this._view.getUint8(this._offset),this._offset+=1,t;case 205:return t=this._view.getUint16(this._offset),this._offset+=2,t;case 206:return t=this._view.getUint32(this._offset),this._offset+=4,t;case 207:return i=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 208:return t=this._view.getInt8(this._offset),this._offset+=1,t;case 209:return t=this._view.getInt16(this._offset),this._offset+=2,t;case 210:return t=this._view.getInt32(this._offset),this._offset+=4,t;case 211:return i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,i+o;case 212:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?void(this._offset+=1):[r,this._bin(1)];case 213:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(2)];case 214:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(4)];case 215:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?(i=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(i+o)):[r,this._bin(8)];case 216:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},t.exports=o},function(t,e,n){"use strict";function r(t,e,n){for(var r=0,i=0,o=n.length;i<o;i++)r=n.charCodeAt(i),r<128?t.setUint8(e++,r):r<2048?(t.setUint8(e++,192|r>>6),t.setUint8(e++,128|63&r)):r<55296||r>=57344?(t.setUint8(e++,224|r>>12),t.setUint8(e++,128|r>>6&63),t.setUint8(e++,128|63&r)):(i++,r=65536+((1023&r)<<10|1023&n.charCodeAt(i)),t.setUint8(e++,240|r>>18),t.setUint8(e++,128|r>>12&63),t.setUint8(e++,128|r>>6&63),t.setUint8(e++,128|63&r))}function i(t){for(var e=0,n=0,r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function o(t,e,n){var r=typeof n,s=0,a=0,u=0,c=0,h=0,f=0;if("string"===r){if((h=i(n))<32)t.push(160|h),f=1;else if(h<256)t.push(217,h),f=2;else if(h<65536)t.push(218,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("String too long");t.push(219,h>>24,h>>16,h>>8,h),f=5}return e.push({_str:n,_length:h,_offset:t.length}),f+h}if("number"===r)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(t.push(n),1):n<256?(t.push(204,n),2):n<65536?(t.push(205,n>>8,n),3):n<4294967296?(t.push(206,n>>24,n>>16,n>>8,n),5):(u=n/Math.pow(2,32)>>0,c=n>>>0,t.push(207,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c),9):n>=-32?(t.push(n),1):n>=-128?(t.push(208,n),2):n>=-32768?(t.push(209,n>>8,n),3):n>=-2147483648?(t.push(210,n>>24,n>>16,n>>8,n),5):(u=Math.floor(n/Math.pow(2,32)),c=n>>>0,t.push(211,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c),9):(t.push(203),e.push({_float:n,_length:8,_offset:t.length}),9);if("object"===r){if(null===n)return t.push(192),1;if(Array.isArray(n)){if((h=n.length)<16)t.push(144|h),f=1;else if(h<65536)t.push(220,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Array too large");t.push(221,h>>24,h>>16,h>>8,h),f=5}for(s=0;s<h;s++)f+=o(t,e,n[s]);return f}if(n instanceof Date){var l=n.getTime();return u=Math.floor(l/Math.pow(2,32)),c=l>>>0,t.push(215,0,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c),10}if(n instanceof ArrayBuffer){if((h=n.byteLength)<256)t.push(196,h),f=2;else if(h<65536)t.push(197,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Buffer too large");t.push(198,h>>24,h>>16,h>>8,h),f=5}return e.push({_bin:n,_length:h,_offset:t.length}),f+h}if("function"==typeof n.toJSON)return o(t,e,n.toJSON());var p=[],d="",v=Object.keys(n);for(s=0,a=v.length;s<a;s++)d=v[s],"function"!=typeof n[d]&&p.push(d);if((h=p.length)<16)t.push(128|h),f=1;else if(h<65536)t.push(222,h>>8,h),f=3;else{if(!(h<4294967296))throw new Error("Object too large");t.push(223,h>>24,h>>16,h>>8,h),f=5}for(s=0;s<h;s++)d=p[s],f+=o(t,e,d),f+=o(t,e,n[d]);return f}if("boolean"===r)return t.push(n?195:194),1;if("undefined"===r)return t.push(212,0,0),3;throw new Error("Could not encode")}function s(t){var e=[],n=[],i=o(e,n,t),s=new ArrayBuffer(i),a=new DataView(s),u=0,c=0,h=-1;n.length>0&&(h=n[0]._offset);for(var f,l=0,p=0,d=0,v=e.length;d<v;d++)if(a.setUint8(c+d,e[d]),d+1===h){if(f=n[u],l=f._length,p=c+h,f._bin)for(var y=new Uint8Array(f._bin),g=0;g<l;g++)a.setUint8(p+g,y[g]);else f._str?r(a,p,f._str):void 0!==f._float&&a.setFloat64(p,f._float);u++,c+=l,n[u]&&(h=n[u]._offset)}return s}t.exports=s},function(t,e,n){"use strict";function r(){function t(t){return e.register(t,null===this)}var e=new i;return t.once=function(t){var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];t.apply(void 0,r),e.remove(n)};e.register(n)},t.remove=function(t){return e.remove(t)},t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)},t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)},t.clear=function(){return e.clear()},t}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.handlers=[]}return t.prototype.register=function(t,e){return void 0===e&&(e=!1),this.handlers.push(t),this},t.prototype.invoke=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handlers.forEach(function(e){return e.apply(void 0,t)})},t.prototype.invokeAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.all(this.handlers.map(function(e){return e.apply(void 0,t)}))},t.prototype.remove=function(t){var e=this.handlers.indexOf(t);this.handlers[e]=this.handlers[this.handlers.length-1],this.handlers.pop()},t.prototype.clear=function(){this.handlers=[]},t}();e.EventEmitter=i,e.createSignal=r},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var s=i(n(20)),a=o(n(3)),u=function(t){function e(e,n){void 0===n&&(n=!0);var r=t.call(this,e,void 0,{connect:n})||this;return r._enqueuedCalls=[],r}return r(e,t),e.prototype.onOpenCallback=function(e){if(t.prototype.onOpenCallback.call(this),this.binaryType="arraybuffer",this._enqueuedCalls.length>0){for(var n=0,r=this._enqueuedCalls;n<r.length;n++){var i=r[n],o=i[0],s=i[1];this[o].apply(this,s)}this._enqueuedCalls=[]}},e.prototype.send=function(e){if(this.ws.readyState===s.default.OPEN)return t.prototype.send.call(this,a.encode(e));this._enqueuedCalls.push(["send",[e]])},e}(s.default);e.Connection=u},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(21).createBackoff,s="undefined"!=typeof WebSocket?WebSocket:n(22),a=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,t),this.url=e,this.protocols=n,this.reconnectEnabled=!0,this.listeners={},this.backoff=o(i.backoff||"exponential",i),this.backoff.onReady=this.onBackoffReady.bind(this),(void 0===i.connect||i.connect)&&this.open()}return i(t,[{key:"open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isReconnect=t;var e=this.ws&&this.ws.binaryType;this.ws=new s(this.url,this.protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this),e&&(this.ws.binaryType=e)}},{key:"onBackoffReady",value:function(t,e){this.open(!0)}},{key:"onCloseCallback",value:function(t){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&t.code<3e3&&this.backoff.backoff()}},{key:"onErrorCallback",value:function(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}},{key:"onMessageCallback",value:function(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}},{key:"onOpenCallback",value:function(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}},{key:"close",value:function(t,e){void 0===t&&(t=1e3),this.reconnectEnabled=!1,this.ws.close(t,e)}},{key:"send",value:function(t){this.ws.send(t)}},{key:"bufferedAmount",get:function(){return this.ws.bufferedAmount}},{key:"readyState",get:function(){return this.ws.readyState}},{key:"binaryType",get:function(){return this.ws.binaryType},set:function(t){this.ws.binaryType=t}},{key:"extensions",get:function(){return this.ws.extensions},set:function(t){this.ws.extensions=t}},{key:"protocol",get:function(){return this.ws.protocol},set:function(t){this.ws.protocol=t}},{key:"onclose",set:function(t){this.listeners.onclose=t},get:function(){return this.listeners.onclose}},{key:"onerror",set:function(t){this.listeners.onerror=t},get:function(){return this.listeners.onerror}},{key:"onmessage",set:function(t){this.listeners.onmessage=t},get:function(){return this.listeners.onmessage}},{key:"onopen",set:function(t){this.listeners.onopen=t},get:function(){return this.listeners.onopen}},{key:"onreconnect",set:function(t){this.listeners.onreconnect=t},get:function(){return this.listeners.onreconnect}}]),t}();a.CONNECTING=s.CONNECTING,a.OPEN=s.OPEN,a.CLOSING=s.CLOSING,a.CLOSED=s.CLOSED,e.default=a},function(t,e,n){"use strict";function r(t,e){return new i(o[t],e)}function i(t,e){this.func=t,this.attempts=0,this.delay=void 0!==e.initialDelay?e.initialDelay:100}Object.defineProperty(e,"__esModule",{value:!0}),e.createBackoff=r;var o={exponential:function(t,e){return Math.floor(Math.random()*Math.pow(2,t)*e)},fibonacci:function(t,e){var n=1;if(t>n)for(var r=1,n=2,i=2;i<t;i++){var o=r+n;r=n,n=o}return Math.floor(Math.random()*n*e)}};i.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},function(t,e){},function(t,e,n){"use strict";function r(){return a||(a="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(t,e){this.cache[t]=e},getItem:function(t){this.cache[t]},removeItem:function(t){delete this.cache[t]}}),a}function i(t,e){r().setItem(t,e)}function o(t){r().removeItem(t)}function s(t,e){var n=r().getItem(t);"undefined"!=typeof Promise&&n instanceof Promise?n.then(function(t){return e(t)}):e(n)}Object.defineProperty(e,"__esModule",{value:!0});var a;e.setItem=i,e.removeItem=o,e.getItem=s},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){function i(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?n(t.value):i(t.value).then(s,a)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(s=u.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this.endpoint=t.replace("ws","http")}return t.prototype.register=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.check(),[4,this.registerServiceWorker()];case 1:return t.sent(),[4,this.requestNotificationPermission()];case 2:return t.sent(),[2]}})})},t.prototype.registerServiceWorker=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,navigator.serviceWorker.register(this.endpoint+"/push")];case 1:return[2,t.sent()]}})})},t.prototype.requestNotificationPermission=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return[4,window.Notification.requestPermission()];case 1:if("granted"!==(t=e.sent()))throw new Error("Permission not granted for Notification");return[2]}})})},t.prototype.check=function(){if(!("serviceWorker"in navigator))throw new Error("No Service Worker support!");if(!("PushManager"in window))throw new Error("No Push API Support!")},t}();e.Push=o},function(t,e,n){function r(t,e){function n(n,r){function o(t){r(t||new Error("Aborted"))}function s(t,e){if(t.bail)return void o(t);c.retry(t)?u.onRetry&&u.onRetry(t,e):r(c.mainError())}function a(e){var r;try{r=t(o,e)}catch(t){return void s(t,e)}Promise.resolve(r).then(n).catch(function(t){s(t,e)})}var u=e||{};"randomize"in u||(u.randomize=!0);var c=i.operation(u);c.attempt(a)}return new Promise(n)}var i=n(26);t.exports=r},function(t,e,n){t.exports=n(27)},function(t,e,n){var r=n(28);e.operation=function(t){var n=e.timeouts(t);return new r(n,{forever:t&&t.forever,unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in t)e[n]=t[n];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<e.retries;i++)r.push(this.createTimeout(i,e));return t&&t.forever&&!r.length&&r.push(this.createTimeout(i,e)),r.sort(function(t,e){return t-e}),r},e.createTimeout=function(t,e){var n=e.randomize?Math.random()+1:1,r=Math.round(n*e.minTimeout*Math.pow(e.factor,t));return r=Math.min(r,e.maxTimeout)},e.wrap=function(t,n,r){if(n instanceof Array&&(r=n,n=null),!r){r=[];for(var i in t)"function"==typeof t[i]&&r.push(i)}for(var o=0;o<r.length;o++){var s=r[o],a=t[s];t[s]=function(r){var i=e.operation(n),o=Array.prototype.slice.call(arguments,1),s=o.pop();o.push(function(t){i.retry(t)||(t&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){r.apply(t,o)})}.bind(t,a),t[s].options=n}}},function(t,e){function n(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),n=this._timeouts.shift()}var r=this,i=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n);return this._options.unref&&i.unref(),!0},n.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},n.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},n.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],o=i.message,s=(t[o]||0)+1;t[o]=s,s>=n&&(e=i,n=s)}return e}},function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=n(30),o=r(n(33)),s=r(n(3)),a=function(){function t(){this.api=new i.StateContainer({})}return t.prototype.getState=function(){return this.api.state},t.prototype.setState=function(t){this.previousState=new Uint8Array(t),this.api.set(s.decode(this.previousState))},t.prototype.patch=function(t){this.previousState=new Uint8Array(o.apply(this.previousState,t)),this.api.set(s.decode(this.previousState))},t.prototype.teardown=function(){this.api.removeAllListeners()},t}();e.FossilDeltaSerializer=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(31);e.StateContainer=r.StateContainer},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(32),i=function(){function t(t){this.listeners=[],this.matcherPlaceholders={":id":/^([a-zA-Z0-9\-_]+)$/,":number":/^([0-9]+)$/,":string":/^(\w+)$/,":axis":/^([xyz])$/,":*":/(.*)/},this.state=t,this.reset()}return t.prototype.set=function(t){var e=r.compare(this.state,t);return this.state=t,this.checkPatches(e,this.listeners,this.defaultListener),e},t.prototype.registerPlaceholder=function(t,e){this.matcherPlaceholders[t]=e},t.prototype.listen=function(t,e,n){var i,o=this;"function"==typeof t?(i=[],e=t):i=t.split("/"),e.length>1&&console.warn(".listen() accepts only one parameter.");var s={callback:e,rawRules:i,rules:i.map(function(t){return"string"==typeof t?0===t.indexOf(":")?o.matcherPlaceholders[t]||o.matcherPlaceholders[":*"]:new RegExp("^"+t+"$"):t})};return 0===i.length?this.defaultListener=s:this.listeners.push(s),n&&this.checkPatches(r.compare({},this.state),[s]),s},t.prototype.removeListener=function(t){for(var e=this.listeners.length-1;e>=0;e--)this.listeners[e]===t&&this.listeners.splice(e,1)},t.prototype.removeAllListeners=function(){this.reset()},t.prototype.checkPatches=function(t,e,n){for(var r=0,i=e.length;r<i;r++)for(var o=e[r],s=t.length-1;s>=0;s--){var a=o&&this.getPathVariables(t[s],o);a&&(o.callback({path:a,rawPath:t[s].path,operation:t[s].operation,value:t[s].value}),t[s].matched=!0)}if(n)for(var s=t.length-1;s>=0;s--)t[s].matched||n.callback(t[s])},t.prototype.getPathVariables=function(t,e){if(t.path.length!==e.rules.length)return!1;for(var n={},r=0,i=e.rules.length;r<i;r++){var o=t.path[r].match(e.rules[r]);if(!o||0===o.length||o.length>2)return!1;":"===e.rawRules[r].substr(0,1)&&(n[e.rawRules[r].substr(1)]=o[1])}return n},t.prototype.reset=function(){this.listeners=[]},t}();e.StateContainer=i},function(t,e,n){"use strict";function r(t,e){var n=[];return s(t,e,n,[]),n}function i(t,e){var n=t.slice();return n.push(e),n}function o(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)t.hasOwnProperty(i)&&r.push(i);return r}function s(t,e,n,r){for(var a=o(e),u=o(t),c=!1,h=u.length-1;h>=0;h--){var f=u[h],l=t[f];if(!e.hasOwnProperty(f)||void 0===e[f]&&void 0!==l&&!1===Array.isArray(e))n.push({operation:"remove",path:i(r,f)}),c=!0;else{var p=e[f];"object"==typeof l&&null!=l&&"object"==typeof p&&null!=p?s(l,p,n,i(r,f)):l!==p&&n.push({operation:"replace",path:i(r,f),value:p,previousValue:l})}}if(c||a.length!=u.length)for(var h=a.length-1;h>=0;h--){var f=a[h];if(!t.hasOwnProperty(f)&&void 0!==e[f]){var p=e[f],d=i(r,f);"object"==typeof p&&null!=p&&s({},p,n,d),n.push({operation:"add",path:d,value:p})}}}Object.defineProperty(e,"__esModule",{value:!0}),e.compare=r},function(t,e){!function(e,n){void 0!==t&&t.exports?t.exports=n():e.fossilDelta=n()}(this,function(){"use strict";function t(){this.a=0,this.b=0,this.i=0,this.z=new Array(s)}function e(t){this.a=t,this.pos=0}function n(){this.a=[]}function r(t){var e,n;for(e=1,n=64;t>=n;e++,n<<=6);return e}function i(t){for(var e=0,n=0,r=0,i=0,o=0,s=t.length;s>=16;)e=e+t[o+0]|0,n=n+t[o+1]|0,r=r+t[o+2]|0,i=i+t[o+3]|0,e=e+t[o+4]|0,n=n+t[o+5]|0,r=r+t[o+6]|0,i=i+t[o+7]|0,e=e+t[o+8]|0,n=n+t[o+9]|0,r=r+t[o+10]|0,i=i+t[o+11]|0,e=e+t[o+12]|0,n=n+t[o+13]|0,r=r+t[o+14]|0,i=i+t[o+15]|0,o+=16,s-=16;for(;s>=4;)e=e+t[o+0]|0,n=n+t[o+1]|0,r=r+t[o+2]|0,i=i+t[o+3]|0,o+=4,s-=4;switch(i=((i+(r<<8)|0)+(n<<16)|0)+(e<<24)|0,s){case 3:i=i+(t[o+2]<<8)|0;case 2:i=i+(t[o+1]<<16)|0;case 1:i=i+(t[o+0]<<24)|0}return i>>>0}var o={},s=16;t.prototype.init=function(t,e){var n,r,i=0,o=0;for(n=0;n<s;n++)r=t[e+n],i=i+r&65535,o=o+(s-n)*r&65535,this.z[n]=r;this.a=65535&i,this.b=65535&o,this.i=0},t.prototype.next=function(t){var e=this.z[this.i];this.z[this.i]=t,this.i=this.i+1&s-1,this.a=this.a-e+t&65535,this.b=this.b-s*e+this.a&65535},t.prototype.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(t){return t.charCodeAt(0)}),u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];return e.prototype.haveBytes=function(){return this.pos<this.a.length},e.prototype.getByte=function(){var t=this.a[this.pos];if(++this.pos>this.a.length)throw new RangeError("out of bounds");return t},e.prototype.getChar=function(){return String.fromCharCode(this.getByte())},e.prototype.getInt=function(){for(var t,e=0;this.haveBytes()&&(t=u[127&this.getByte()])>=0;)e=(e<<6)+t;return this.pos--,e>>>0},n.prototype.toArray=function(){return this.a},n.prototype.putByte=function(t){this.a.push(255&t)},n.prototype.putChar=function(t){this.putByte(t.charCodeAt(0))},n.prototype.putInt=function(t){var e,n,r=[];if(0===t)return void this.putChar("0");for(e=0;t>0;e++,t>>>=6)r.push(a[63&t]);for(n=e-1;n>=0;n--)this.putByte(r[n])},n.prototype.putArray=function(t,e,n){for(var r=e;r<n;r++)this.a.push(t[r])},o.create=function(e,o){var a,u=new n,c=o.length,h=e.length,f=-1;if(u.putInt(c),u.putChar("\n"),h<=s)return u.putInt(c),u.putChar(":"),u.putArray(o,0,c),u.putInt(i(o)),u.putChar(";"),u.toArray();var l=Math.ceil(h/s),p=new Array(l),d=new Array(l);for(a=0;a<p.length;a++)p[a]=-1;for(a=0;a<d.length;a++)d[a]=-1;var v,y=new t;for(a=0;a<h-s;a+=s)y.init(e,a),v=y.value()%l,p[a/s]=d[v],d[v]=a/s;for(var g,_,m,b,w,C=0;C+s<c;)for(b=0,w=0,y.init(o,C),a=0,m=0;;){var O=250;for(v=y.value()%l,_=d[v];_>=0&&O-- >0;){var A,S,k,E,I,T,x,P;for(g=_*s,E=0,T=g,x=C+a;T<h&&x<c&&e[T]===o[x];E++,T++,x++);for(E--,I=1;I<g&&I<=a&&e[g-I]===o[C+a-I];I++);I--,S=g-I,A=E+I+1,k=a-I,P=r(a-I)+r(A)+r(S)+3,A>=P&&A>m&&(m=A,b=g-I,w=k),_=p[_]}if(m>0){w>0&&(u.putInt(w),u.putChar(":"),u.putArray(o,C,C+w),C+=w),C+=m,u.putInt(m),u.putChar("@"),u.putInt(b),u.putChar(","),b+m-1>f&&(f=b+m-1),m=0;break}if(C+a+s>=c){u.putInt(c-C),u.putChar(":"),u.putArray(o,C,C+c-C),C=c;break}y.next(o[C+a+s]),a++}return C<c&&(u.putInt(c-C),u.putChar(":"),u.putArray(o,C,C+c-C)),u.putInt(i(o)),u.putChar(";"),u.toArray()},o.outputSize=function(t){var n=new e(t),r=n.getInt();if("\n"!==n.getChar())throw new Error("size integer not terminated by '\\n'");return r},o.apply=function(t,r,o){var s,a=0,u=new e(r),c=t.length,h=r.length;if(s=u.getInt(),"\n"!==u.getChar())throw new Error("size integer not terminated by '\\n'");for(var f=new n;u.haveBytes();){var l,p;switch(l=u.getInt(),u.getChar()){case"@":if(p=u.getInt(),u.haveBytes()&&","!==u.getChar())throw new Error("copy command not terminated by ','");if((a+=l)>s)throw new Error("copy exceeds output file size");if(p+l>c)throw new Error("copy extends past end of input");f.putArray(t,p,p+l);break;case":":if((a+=l)>s)throw new Error("insert command gives an output larger than predicted");if(l>h)throw new Error("insert count exceeds size of delta");f.putArray(u.a,u.pos,u.pos+l),u.pos+=l;break;case";":var d=f.toArray();if((!o||!1!==o.verifyChecksum)&&l!==i(d))throw new Error("bad checksum");if(a!==s)throw new Error("generated size does not match predicted size");return d;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")},o})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(9),i=function(){function t(){}return t.prototype.setState=function(t){this.state.decode(t)},t.prototype.getState=function(){return this.state},t.prototype.patch=function(t){this.state.decode(t)},t.prototype.teardown=function(){},t.prototype.handshake=function(t){if(this.state){(new r.Reflection).decode(t)}else this.state=r.Reflection.decode(t)},t}();e.SchemaSerializer=i},function(t,e,n){"use strict";function r(t){for(var e=0,n=0,r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}function i(t,e,n){for(var r=0,i=0,o=n.length;i<o;i++)r=n.charCodeAt(i),r<128?t[e++]=r:r<2048?(t[e++]=192|r>>6,t[e++]=128|63&r):r<55296||r>=57344?(t[e++]=224|r>>12,t[e++]=128|r>>6&63,t[e++]=128|63&r):(i++,r=65536+((1023&r)<<10|1023&n.charCodeAt(i)),t[e++]=240|r>>18,t[e++]=128|r>>12&63,t[e++]=128|r>>6&63,t[e++]=128|63&r)}function o(t,e){t.push(e)}function s(t,e){t.push(e)}function a(t,e){t.push(e),t.push(e>>8)}function u(t,e){t.push(e),t.push(e>>8)}function c(t,e){t.push(e),t.push(e>>8),t.push(e>>16),t.push(e>>24)}function h(t,e){var n=e>>24,r=e>>16,i=e>>8,o=e;t.push(o),t.push(i),t.push(r),t.push(n)}function f(t,e){var n=Math.floor(e/Math.pow(2,32));h(t,e>>>0),h(t,n)}function l(t,e){var n=e/Math.pow(2,32)>>0;h(t,e>>>0),h(t,n)}function p(t,e){v(t,e)}function d(t,e){y(t,e)}function v(t,e){C[0]=e,c(t,w[0])}function y(t,e){O[0]=e,c(t,w[b?0:1]),c(t,w[b?1:0])}function g(t,e){return s(t,e?1:0)}function _(t,e){e||(e="");var n=r(e),o=0;if(n<32)t.push(160|n),o=1;else if(n<256)t.push(217),s(t,n),o=2;else if(n<65536)t.push(218),u(t,n),o=3;else{if(!(n<4294967296))throw new Error("String too long");t.push(219),h(t,n),o=5}return i(t,t.length,e),o+n}function m(t,e){return isNaN(e)?m(t,0):isFinite(e)?e!==(0|e)?(t.push(203),y(t,e),9):e>=0?e<128?(s(t,e),1):e<256?(t.push(204),s(t,e),2):e<65536?(t.push(205),u(t,e),3):e<4294967296?(t.push(206),h(t,e),5):(t.push(207),l(t,e),9):e>=-32?(t.push(e),1):e>=-128?(t.push(208),o(t,e),2):e>=-32768?(t.push(209),a(t,e),3):e>=-2147483648?(t.push(210),c(t,e),5):(t.push(211),f(t,e),9):m(t,e>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}Object.defineProperty(e,"__esModule",{value:!0}),e.utf8Write=i,e.int8=o,e.uint8=s,e.int16=a,e.uint16=u,e.int32=c,e.uint32=h,e.int64=f,e.uint64=l,e.float32=p,e.float64=d;var b=!0,w=new Int32Array(2),C=new Float32Array(w.buffer),O=new Float64Array(w.buffer);e.writeFloat32=v,e.writeFloat64=y,e.boolean=g,e.string=_,e.number=m},function(t,e,n){"use strict";function r(t,e,n){for(var r="",i=0,o=e,s=e+n;o<s;o++){var a=t[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));i=(7&a)<<18|(63&t[++o])<<12|(63&t[++o])<<6|(63&t[++o])<<0,i>=65536?(i-=65536,r+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):r+=String.fromCharCode(i)}else r+=String.fromCharCode((15&a)<<12|(63&t[++o])<<6|(63&t[++o])<<0);else r+=String.fromCharCode((31&a)<<6|63&t[++o]);else r+=String.fromCharCode(a)}return r}function i(t,e){return o(t,e)<<24>>24}function o(t,e){return t[e.offset++]}function s(t,e){return a(t,e)<<16>>16}function a(t,e){return t[e.offset++]|t[e.offset++]<<8}function u(t,e){return t[e.offset++]|t[e.offset++]<<8|t[e.offset++]<<16|t[e.offset++]<<24}function c(t,e){return u(t,e)>>>0}function h(t,e){return d(t,e)}function f(t,e){return v(t,e)}function l(t,e){var n=c(t,e);return u(t,e)*Math.pow(2,32)+n}function p(t,e){var n=c(t,e);return c(t,e)*Math.pow(2,32)+n}function d(t,e){return k[0]=u(t,e),E[0]}function v(t,e){return k[S?0:1]=u(t,e),k[S?1:0]=u(t,e),I[0]}function y(t,e){return o(t,e)>0}function g(t,e){var n,i=t[e.offset++];i<192?n=31&i:217===i?n=o(t,e):218===i?n=a(t,e):219===i&&(n=c(t,e));var s=r(t,e.offset,n);return e.offset+=n,s}function _(t,e){var n=t[e.offset];return n<192&&n>160||217===n||218===n||219===n}function m(t,e){var n=t[e.offset++];return n<128?n:202===n?d(t,e):203===n?v(t,e):204===n?o(t,e):205===n?a(t,e):206===n?c(t,e):207===n?p(t,e):208===n?i(t,e):209===n?s(t,e):210===n?u(t,e):211===n?l(t,e):n>223?-1*(255-n+1):void 0}function b(t,e){var n=t[e.offset];return n<128||n>=202&&n<=211}function w(t,e){return t[e.offset]<160}function C(t,e){return t[e.offset]===A.NIL}function O(t,e){return t[e.offset]===A.INDEX_CHANGE}Object.defineProperty(e,"__esModule",{value:!0});var A=n(10);e.int8=i,e.uint8=o,e.int16=s,e.uint16=a,e.int32=u,e.uint32=c,e.float32=h,e.float64=f,e.int64=l,e.uint64=p;var S=!0,k=new Int32Array(2),E=new Float32Array(k.buffer),I=new Float64Array(k.buffer);e.readFloat32=d,e.readFloat64=v,e.boolean=y,e.string=g,e.stringCheck=_,e.number=m,e.numberCheck=b,e.arrayCheck=w,e.nilCheck=C,e.indexChangeCheck=O},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(12),s=n(0),a=n(1),u=n(2),c=new o.Context,h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),i([o.type("string",c)],e.prototype,"name",void 0),i([o.type("string",c)],e.prototype,"type",void 0),i([o.type("uint8",c)],e.prototype,"referencedType",void 0),e}(s.Schema);e.ReflectionField=h;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields=new a.ArraySchema,e}return r(e,t),i([o.type("uint8",c)],e.prototype,"id",void 0),i([o.type([h],c)],e.prototype,"fields",void 0),e}(s.Schema);e.ReflectionType=f;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.types=new a.ArraySchema,e}return r(e,t),e.encode=function(t){var n=t.constructor,r=new e;r.rootType=n._typeid;var i=n._context.types;for(var o in i){var s=new f;s.id=Number(o),function(t,e){for(var n in e){var i=new h;i.name=n;var o=void 0;if("string"==typeof e[n])o=e[n];else{var s="function"==typeof e[n],a=Array.isArray(e[n]),u=!a&&e[n].map,c=void 0;s?(o="ref",c=e[n]):a?(o="array","string"==typeof e[n][0]?o+=":"+e[n][0]:c=e[n][0]):u&&(o="map","string"==typeof e[n].map?o+=":"+e[n].map:c=e[n].map),i.referencedType=c?c._typeid:255}i.type=o,t.fields.push(i)}r.types.push(t)}(s,i[o]._schema)}return r.encodeAll()},e.decode=function(t){var n=new o.Context,i=new e;i.decode(t);var c=i.types.reduce(function(t,e){return t[e.id]=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(s.Schema),t},{});i.types.forEach(function(t,e){t.fields.forEach(function(e){var r=c[t.id];if(void 0!==e.referencedType){var i=c[e.referencedType];i||(i=e.type.split(":")[1]),0===e.type.indexOf("array")?o.type([i],n)(r.prototype,e.name):0===e.type.indexOf("map")?o.type({map:i},n)(r.prototype,e.name):"ref"===e.type&&o.type(i,n)(r.prototype,e.name)}else o.type(e.type,n)(r.prototype,e.name)})});var h=c[i.rootType],f=new h;for(var l in h._schema){var p=h._schema[l];if("string"!=typeof p){var d="function"==typeof p,v=Array.isArray(p),y=!v&&p.map;f[l]=v?new a.ArraySchema:y?new u.MapSchema:d?new p:void 0}}return f},i([o.type([f],c)],e.prototype,"types",void 0),i([o.type("uint8",c)],e.prototype,"rootType",void 0),e}(s.Schema);e.Reflection=l}])});